# 实现计划

- [x] 1. 设置项目结构和依赖





  - 创建项目目录结构（static、templates 文件夹）
  - 创建 requirements.txt 文件，包含 Flask、openai、python-dotenv 依赖
  - 创建 .env.example 文件作为环境变量配置模板
  - 创建 .gitignore 文件，排除 .env 和 __pycache__
  - _需求: 5.1, 5.2, 5.3_

- [x] 2. 实现后端 Flask 应用核心




  - [x] 2.1 创建 Flask 应用基础结构


    - 编写 app.py 文件，初始化 Flask 应用
    - 配置环境变量加载（使用 python-dotenv）
    - 实现主页路由 GET /，返回 HTML 页面
    - _需求: 5.1, 5.3_

  - [x] 2.2 实现 OpenAI API 集成


    - 编写函数构建推荐提示词，根据用户心情生成合适的 prompt
    - 编写函数调用 OpenAI API，传递心情描述并获取推荐
    - 编写函数解析 API 响应，提取书名、作者和推荐理由
    - 实现错误处理，捕获 API 调用异常
    - _需求: 1.4, 4.1, 4.3_

  - [x] 2.3 实现推荐 API 端点


    - 创建 POST /api/recommend 路由
    - 实现请求验证，检查 mood 字段是否存在且不为空
    - 调用 OpenAI 集成函数获取推荐结果
    - 返回 JSON 格式的推荐数据或错误信息
    - 设置 30 秒超时处理
    - _需求: 1.3, 1.4, 2.3, 4.1, 4.2, 4.3, 4.4_

- [x] 3. 实现前端界面





  - [x] 3.1 创建 HTML 页面结构


    - 创建 templates/index.html 文件
    - 实现页面布局：标题、心情输入区、预设选项、提交按钮
    - 添加推荐结果展示区域
    - 添加加载状态指示器元素
    - 添加错误提示区域
    - _需求: 1.1, 1.2, 3.1, 3.2, 3.3, 3.4, 6.2_

  - [x] 3.2 实现 CSS 样式


    - 创建 static/style.css 文件
    - 实现响应式布局，适配移动端和桌面端
    - 设计输入表单样式
    - 设计推荐结果卡片样式
    - 设计加载动画效果
    - 设计错误提示样式
    - _需求: 6.1, 6.2, 6.3, 6.4_

  - [x] 3.3 实现客户端 JavaScript 逻辑


    - 创建 static/script.js 文件
    - 实现表单提交处理函数，阻止默认提交行为
    - 实现客户端输入验证，检查心情输入不为空
    - 实现 AJAX 请求函数，发送 POST 请求到 /api/recommend
    - 实现加载状态显示和隐藏函数
    - 实现推荐结果渲染函数，动态创建推荐卡片
    - 实现错误处理和显示函数
    - 添加预设心情选项的点击事件处理
    - _需求: 1.3, 1.4, 2.1, 2.2, 3.1, 3.2, 3.3, 3.4, 4.1, 4.2, 4.4, 6.3_

- [x] 4. 配置和文档





  - 创建 README.md 文件，包含项目说明、安装步骤、运行方法
  - 在 .env.example 中添加配置说明和示例值
  - 添加代码注释，说明关键函数和逻辑
  - _需求: 5.4_

- [ ] 5. 实现书籍类别功能 - 后端部分





  - [x] 5.1 定义类别数据结构







    - 在 app.py 中创建 BOOK_CATEGORIES 常量，包含 12 个主要类别及其子类别
    - 每个类别包含 id、name 和 subcategories 字段
    - _需求: 7.2_

  - [x] 5.2 实现类别 API 端点


    - 创建 GET /api/categories 路由
    - 返回所有可用的书籍类别列表（JSON 格式）
    - _需求: 7.2_

  - [x] 5.3 更新推荐 API 以支持类别


    - 修改 POST /api/recommend 端点，接收可选的 categories 参数
    - 更新请求验证逻辑，验证 categories 参数格式（如果提供）
    - _需求: 7.1, 7.3_

  - [x] 5.4 更新 Prompt 构建函数


    - 修改 build_prompt 函数，接收 categories 参数
    - 当用户指定类别时，在 prompt 中包含类别偏好信息
    - 更新 prompt 格式要求，要求 GPT 在响应中包含 category 和 subcategory 字段
    - _需求: 7.3, 7.4_

  - [x] 5.5 更新响应解析函数


    - 修改 parse_response 函数，解析并验证 category 和 subcategory 字段
    - 确保每本推荐书籍都包含类别信息
    - _需求: 7.4_

  - [x] 5.6 更新 OpenAI 集成函数


    - 修改 get_book_recommendations 函数签名，接收 categories 参数
    - 将 categories 参数传递给 build_prompt 函数
    - _需求: 7.3_
-

- [ ] 6. 实现书籍类别功能 - 前端部分




  - [x] 6.1 创建类别选择器组件


    - 在 index.html 中添加类别选择器 UI 元素
    - 使用可折叠的多选框或标签云形式展示类别
    - 默认状态为折叠，显示"选择感兴趣的类别（可选）"提示
    - _需求: 7.1, 7.2_

  - [x] 6.2 实现类别数据加载


    - 在 script.js 中添加函数，从 /api/categories 获取类别列表
    - 页面加载时调用该函数，动态渲染类别选择器
    - _需求: 7.2_

  - [x] 6.3 更新表单提交逻辑


    - 修改 submitMood 函数，收集用户选择的类别
    - 在 POST 请求中包含 categories 参数（如果用户选择了类别）
    - _需求: 7.1, 7.3_

  - [x] 6.4 实现类别分组展示


    - 修改 displayRecommendations 函数，支持按类别分组显示推荐结果
    - 当推荐结果包含 3 个或以上不同类别时，使用分组展示
    - 每个分组显示类别名称标签
    - _需求: 7.6, 7.7_

  - [x] 6.5 实现类别标签显示

    - 在推荐结果卡片中显示书籍的类别标签（badge）
    - 使用不同颜色或样式区分不同类别
    - _需求: 7.4_

  - [x] 6.6 实现类别筛选功能


    - 在推荐结果上方添加类别筛选器 UI
    - 显示所有出现在推荐结果中的类别标签
    - 实现 filterByCategory 函数，点击类别标签时筛选显示对应类别的书籍
    - 支持"全部"选项清除筛选
    - _需求: 7.5, 7.8_

  - [x] 6.7 更新 CSS 样式


    - 为类别选择器添加样式
    - 为类别标签（badge）添加样式
    - 为类别分组添加样式
    - 为类别筛选器添加样式
    - 确保响应式设计适配类别功能
    - _需求: 7.2, 7.4, 7.5, 7.7_

- [ ] 7. 测试和优化类别功能

  - [ ] 7.1 测试类别 API 端点
    - 测试 GET /api/categories 返回正确的类别数据
    - 测试 POST /api/recommend 接收和处理 categories 参数
    - _需求: 7.2, 7.3_

  - [ ] 7.2 测试前端类别交互
    - 测试类别选择器的展开/折叠功能
    - 测试多选类别功能
    - 测试类别筛选器的交互
    - 测试不同设备上的响应式布局
    - _需求: 7.1, 7.5, 7.8_

  - [ ] 7.3 测试推荐结果展示
    - 测试指定类别时的推荐结果
    - 测试未指定类别时的推荐结果
    - 测试类别分组展示逻辑
    - 测试类别标签显示
    - _需求: 7.3, 7.4, 7.6, 7.7_

  - [ ]* 7.4 端到端测试
    - 测试完整流程：选择心情 → 选择类别 → 获得推荐 → 筛选类别
    - 测试边界情况：选择所有类别、不选择类别、选择单个类别
    - 测试错误处理：无效的类别参数、API 返回缺少类别信息
    - _需求: 7.1, 7.3, 7.4, 7.5_

- [ ] 8. 更新文档

  - 更新 README.md，添加类别功能的使用说明
  - 在代码中添加类别相关函数的注释
  - 更新 API 文档，说明新的端点和参数
  - _需求: 7.1, 7.2_
